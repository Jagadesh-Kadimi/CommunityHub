<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events - Community Connect Hub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/animations.css">
    <link rel="stylesheet" href="../css/responsive.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden">
        <div class="spinner"></div>
    </div>
    
    <!-- Header -->
    <header>
        <div class="container">
            <div class="logo">
                <a href="../index.html">
                    <svg class="logo-svg" width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 0C8.954 0 0 8.954 0 20C0 31.046 8.954 40 20 40C31.046 40 40 31.046 40 20C40 8.954 31.046 0 20 0ZM20 6C23.866 6 27 9.134 27 13C27 16.866 23.866 20 20 20C16.134 20 13 16.866 13 13C13 9.134 16.134 6 20 6ZM20 34.4C15 34.4 10.56 31.88 8 27.96C8.08 23.98 16 21.8 20 21.8C23.98 21.8 31.92 23.98 32 27.96C29.44 31.88 25 34.4 20 34.4Z" fill="#4CAF50"/>
                    </svg>
                    <span>Community Connect Hub</span>
                </a>
            </div>
            <nav>
                <ul class="nav-links">
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="events.html" class="active">Events</a></li>
                    <li><a href="community.html">Community</a></li>
                    <li id="auth-link"><a href="login.html">Login</a></li>
                </ul>
                <button class="hamburger" id="hamburger">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </div>
    </header>

    <!-- Events Hero Section -->
    <section class="events-hero">
        <div class="container">
            <div class="events-hero-content">
                <h1 class="fade-in">Discover Community Events</h1>
                <p class="fade-in delay-1">Find and join events happening in your neighborhood</p>
                
                <div class="events-search-bar fade-in delay-2">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search"></i>
                        <input type="text" id="events-search" placeholder="Search for events...">
                    </div>
                    <button id="advanced-search-toggle" class="btn btn-text">
                        <i class="fas fa-sliders-h"></i> Filters
                    </button>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Events Filter Section -->
    <section class="events-filters">
        <div class="container">
            <div class="filters-container">
                <div class="filter-group">
                    <label for="category-filter">Category</label>
                    <select id="category-filter" class="filter-select">
                        <option value="all">All Categories</option>
                        <option value="social">Social</option>
                        <option value="volunteer">Volunteer</option>
                        <option value="education">Education</option>
                        <option value="sports">Sports</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="date-filter">When</label>
                    <select id="date-filter" class="filter-select">
                        <option value="all">Any Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="sort-filter">Sort By</label>
                    <select id="sort-filter" class="filter-select">
                        <option value="date-asc">Date (Soonest First)</option>
                        <option value="date-desc">Date (Latest First)</option>
                        <option value="title-asc">Title (A-Z)</option>
                        <option value="popularity">Popularity</option>
                    </select>
                </div>
                
                <div class="filter-actions">
                    <button id="clear-filters" class="btn btn-text">
                        <i class="fas fa-times"></i> Clear Filters
                    </button>
                </div>
            </div>
            
            <div class="active-filters">
                <span class="filter-label">Active Filters:</span>
                <div id="active-filters-list">
                    <span class="filter-tag">All Categories</span>
                    <span class="filter-tag">Any Time</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Events List Section -->
    <section class="events-list-section">
        <div class="container">
            <div class="events-header">
                <h2>Available Events</h2>
                <a href="create-event.html" class="btn btn-primary create-event-btn">
                    <i class="fas fa-plus"></i> Create Event
                </a>
            </div>
            
            <div id="events-results-info" class="events-results-info">
                Showing all events
            </div>
            
            <div id="events-list-container" class="events-grid">
                <!-- Events will be loaded here dynamically -->
                <div class="events-placeholder">
                    <div class="spinner"></div>
                    <p>Loading events...</p>
                </div>
            </div>
            
            <div class="events-pagination">
                <button class="pagination-btn prev-btn" disabled>
                    <i class="fas fa-chevron-left"></i> Previous
                </button>
                <div class="pagination-info">Page <span id="current-page">1</span> of <span id="total-pages">1</span></div>
                <button class="pagination-btn next-btn" disabled>
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- No Results Message (Hidden by default) -->
    <section id="no-results-section" class="no-results-section hidden">
        <div class="container">
            <div class="no-results-content">
                <i class="fas fa-search"></i>
                <h2>No events found</h2>
                <p>Try adjusting your search or filters to find what you're looking for.</p>
                <button id="reset-search" class="btn btn-primary">Reset Search</button>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <svg class="logo-svg" width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 0C8.954 0 0 8.954 0 20C0 31.046 8.954 40 20 40C31.046 40 40 31.046 40 20C40 8.954 31.046 0 20 0ZM20 6C23.866 6 27 9.134 27 13C27 16.866 23.866 20 20 20C16.134 20 13 16.866 13 13C13 9.134 16.134 6 20 6ZM20 34.4C15 34.4 10.56 31.88 8 27.96C8.08 23.98 16 21.8 20 21.8C23.98 21.8 31.92 23.98 32 27.96C29.44 31.88 25 34.4 20 34.4Z" fill="#FFFFFF"/>
                    </svg>
                    <h3>Community Connect Hub</h3>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h4>Navigation</h4>
                        <ul>
                            <li><a href="../index.html">Home</a></li>
                            <li><a href="events.html">Events</a></li>
                            <li><a href="community.html">Community</a></li>
                            <li><a href="create-event.html">Create Event</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Account</h4>
                        <ul>
                            <li><a href="login.html">Login</a></li>
                            <li><a href="signup.html">Sign Up</a></li>
                            <li><a href="profile.html">Profile</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Connect</h4>
                        <div class="social-links">
                            <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                            <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                            <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                            <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Community Connect Hub. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Notification Toast -->
    <div id="notification-toast" class="notification hidden">
        <div class="notification-content">
            <i class="notification-icon"></i>
            <p class="notification-message"></p>
        </div>
        <button class="notification-close">×</button>
    </div>
    
    <!-- Scripts -->
    <script src="../js/data.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/events.js"></script>
    <script src="../js/ui.js"></script>
    <script src="../js/main.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Pagination variables
            let currentPage = 1;
            let eventsPerPage = 9;
            let filteredEvents = [];
            
            // Initialize with all events
            async function initEvents() {
                UI.showLoading();
                
                try {
                    // Get all events
                    const events = await DataService.getEvents();
                    filteredEvents = [...events];
                    
                    // Sort by date (soonest first by default)
                    filteredEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
                    
                    // Render events
                    renderEvents();
                    updatePagination();
                    
                } catch (error) {
                    console.error('Error initializing events:', error);
                    UI.showNotification('Error loading events', 'error');
                } finally {
                    UI.hideLoading();
                }
            }
            
            // Render events for current page
            function renderEvents() {
                const container = document.getElementById('events-list-container');
                const noResultsSection = document.getElementById('no-results-section');
                
                if (!container) return;
                
                // Clear container
                container.innerHTML = '';
                
                if (filteredEvents.length === 0) {
                    noResultsSection.classList.remove('hidden');
                    container.innerHTML = '';
                    return;
                }
                
                noResultsSection.classList.add('hidden');
                
                // Calculate page bounds
                const startIndex = (currentPage - 1) * eventsPerPage;
                const endIndex = Math.min(startIndex + eventsPerPage, filteredEvents.length);
                
                // Update results count
                const resultsInfo = document.getElementById('events-results-info');
                if (resultsInfo) {
                    resultsInfo.textContent = `Showing ${startIndex + 1}-${endIndex} of ${filteredEvents.length} events`;
                }
                
                // Render events for current page
                for (let i = startIndex; i < endIndex; i++) {
                    const event = filteredEvents[i];
                    const delay = (i - startIndex) * 100;
                    const eventCard = UI.createEventCard(event, delay);
                    container.appendChild(eventCard);
                }
            }
            
            // Update pagination controls
            function updatePagination() {
                const totalPages = Math.ceil(filteredEvents.length / eventsPerPage);
                const currentPageEl = document.getElementById('current-page');
                const totalPagesEl = document.getElementById('total-pages');
                const prevBtn = document.querySelector('.prev-btn');
                const nextBtn = document.querySelector('.next-btn');
                
                if (currentPageEl && totalPagesEl) {
                    currentPageEl.textContent = currentPage;
                    totalPagesEl.textContent = totalPages;
                }
                
                if (prevBtn) {
                    prevBtn.disabled = currentPage <= 1;
                }
                
                if (nextBtn) {
                    nextBtn.disabled = currentPage >= totalPages;
                }
            }
            
            // Apply filters and search
            async function applyFilters() {
                UI.showLoading();
                
                try {
                    const searchInput = document.getElementById('events-search');
                    const categoryFilter = document.getElementById('category-filter');
                    const dateFilter = document.getElementById('date-filter');
                    const sortFilter = document.getElementById('sort-filter');
                    
                    // Get all events
                    const allEvents = await DataService.getEvents();
                    
                    // Apply filters
                    let filtered = [...allEvents];
                    
                    // Search filter
                    if (searchInput && searchInput.value.trim()) {
                        const searchTerm = searchInput.value.trim().toLowerCase();
                        filtered = filtered.filter(event => 
                            event.title.toLowerCase().includes(searchTerm) || 
                            event.description.toLowerCase().includes(searchTerm) ||
                            event.location.toLowerCase().includes(searchTerm)
                        );
                    }
                    
                    // Category filter
                    if (categoryFilter && categoryFilter.value !== 'all') {
                        filtered = filtered.filter(event => 
                            event.category === categoryFilter.value
                        );
                    }
                    
                    // Date filter
                    if (dateFilter && dateFilter.value !== 'all') {
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        
                        const tomorrow = new Date(today);
                        tomorrow.setDate(tomorrow.getDate() + 1);
                        
                        const nextWeek = new Date(today);
                        nextWeek.setDate(nextWeek.getDate() + 7);
                        
                        const nextMonth = new Date(today);
                        nextMonth.setMonth(nextMonth.getMonth() + 1);
                        
                        switch (dateFilter.value) {
                            case 'today':
                                filtered = filtered.filter(event => {
                                    const eventDate = new Date(event.date);
                                    eventDate.setHours(0, 0, 0, 0);
                                    return eventDate.getTime() === today.getTime();
                                });
                                break;
                            case 'week':
                                filtered = filtered.filter(event => {
                                    const eventDate = new Date(event.date);
                                    return eventDate >= today && eventDate < nextWeek;
                                });
                                break;
                            case 'month':
                                filtered = filtered.filter(event => {
                                    const eventDate = new Date(event.date);
                                    return eventDate >= today && eventDate < nextMonth;
                                });
                                break;
                        }
                    }
                    
                    // Apply sorting
                    if (sortFilter) {
                        switch (sortFilter.value) {
                            case 'date-asc':
                                filtered.sort((a, b) => new Date(a.date) - new Date(b.date));
                                break;
                            case 'date-desc':
                                filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
                                break;
                            case 'title-asc':
                                filtered.sort((a, b) => a.title.localeCompare(b.title));
                                break;
                            case 'popularity':
                                filtered.sort((a, b) => 
                                    (b.attendees ? b.attendees.length : 0) - 
                                    (a.attendees ? a.attendees.length : 0)
                                );
                                break;
                        }
                    }
                    
                    // Update active filters display
                    updateActiveFilters();
                    
                    // Reset to first page
                    currentPage = 1;
                    
                    // Update filtered events
                    filteredEvents = filtered;
                    
                    // Render events
                    renderEvents();
                    updatePagination();
                    
                } catch (error) {
                    console.error('Error applying filters:', error);
                    UI.showNotification('Error filtering events', 'error');
                } finally {
                    UI.hideLoading();
                }
            }
            
            // Update active filters display
            function updateActiveFilters() {
                const filtersList = document.getElementById('active-filters-list');
                const categoryFilter = document.getElementById('category-filter');
                const dateFilter = document.getElementById('date-filter');
                
                if (!filtersList) return;
                
                // Clear existing filters
                filtersList.innerHTML = '';
                
                // Add category filter
                if (categoryFilter) {
                    const categoryText = categoryFilter.options[categoryFilter.selectedIndex].text;
                    const categoryTag = document.createElement('span');
                    categoryTag.className = 'filter-tag';
                    categoryTag.textContent = categoryText;
                    filtersList.appendChild(categoryTag);
                }
                
                // Add date filter
                if (dateFilter) {
                    const dateText = dateFilter.options[dateFilter.selectedIndex].text;
                    const dateTag = document.createElement('span');
                    dateTag.className = 'filter-tag';
                    dateTag.textContent = dateText;
                    filtersList.appendChild(dateTag);
                }
                
                // Add search term if present
                const searchInput = document.getElementById('events-search');
                if (searchInput && searchInput.value.trim()) {
                    const searchTag = document.createElement('span');
                    searchTag.className = 'filter-tag';
                    searchTag.textContent = `"${searchInput.value.trim()}"`;
                    filtersList.appendChild(searchTag);
                }
            }
            
            // Clear all filters
            function clearFilters() {
                const searchInput = document.getElementById('events-search');
                const categoryFilter = document.getElementById('category-filter');
                const dateFilter = document.getElementById('date-filter');
                const sortFilter = document.getElementById('sort-filter');
                
                if (searchInput) searchInput.value = '';
                if (categoryFilter) categoryFilter.value = 'all';
                if (dateFilter) dateFilter.value = 'all';
                if (sortFilter) sortFilter.value = 'date-asc';
                
                applyFilters();
            }
            
            // Set up event listeners
            function setupEventListeners() {
                // Filter and search inputs
                const searchInput = document.getElementById('events-search');
                const categoryFilter = document.getElementById('category-filter');
                const dateFilter = document.getElementById('date-filter');
                const sortFilter = document.getElementById('sort-filter');
                const clearFiltersBtn = document.getElementById('clear-filters');
                const resetSearchBtn = document.getElementById('reset-search');
                
                // Add input event listener with debounce for search
                if (searchInput) {
                    let debounceTimer;
                    searchInput.addEventListener('input', () => {
                        clearTimeout(debounceTimer);
                        debounceTimer = setTimeout(() => {
                            applyFilters();
                        }, 300);
                    });
                }
                
                // Add change event listeners for select filters
                if (categoryFilter) {
                    categoryFilter.addEventListener('change', applyFilters);
                }
                
                if (dateFilter) {
                    dateFilter.addEventListener('change', applyFilters);
                }
                
                if (sortFilter) {
                    sortFilter.addEventListener('change', applyFilters);
                }
                
                // Clear filters button
                if (clearFiltersBtn) {
                    clearFiltersBtn.addEventListener('click', clearFilters);
                }
                
                // Reset search button
                if (resetSearchBtn) {
                    resetSearchBtn.addEventListener('click', clearFilters);
                }
                
                // Pagination buttons
                const prevBtn = document.querySelector('.prev-btn');
                const nextBtn = document.querySelector('.next-btn');
                
                if (prevBtn) {
                    prevBtn.addEventListener('click', () => {
                        if (currentPage > 1) {
                            currentPage--;
                            renderEvents();
                            updatePagination();
                            window.scrollTo({top: 0, behavior: 'smooth'});
                        }
                    });
                }
                
                if (nextBtn) {
                    nextBtn.addEventListener('click', () => {
                        const totalPages = Math.ceil(filteredEvents.length / eventsPerPage);
                        if (currentPage < totalPages) {
                            currentPage++;
                            renderEvents();
                            updatePagination();
                            window.scrollTo({top: 0, behavior: 'smooth'});
                        }
                    });
                }
            }
            
            // Initialize page
            initEvents();
            setupEventListeners();
        });
    </script>
</body>
</html>
